(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{326:function(e,t,n){e.exports=n(754)},331:function(e,t,n){},333:function(e,t,n){},353:function(e,t,n){},355:function(e,t,n){},357:function(e,t,n){},373:function(e,t,n){},563:function(e,t){},565:function(e,t){},574:function(e,t,n){},576:function(e,t,n){},747:function(e,t,n){},750:function(e,t,n){},754:function(e,t,n){"use strict";n.r(t);var a=n(1),o=n.n(a),r=n(6),s=n.n(r),i=(n(331),n(9)),l=n(7),c=n(12),d=n(11),u=n(13),h=n(786),p=n(788),g=n(789),m=n(761),f=n(337),y=n(762),v=(n(333),function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"Home"},o.a.createElement(m.a,{className:"jumbo"},o.a.createElement("h1",{className:"display-3"},o.a.createElement("span",null,"Retina"),o.a.createElement("span",{className:"x"},"X")),o.a.createElement("p",{className:"lead"},"A simple retina neural functionality simulator"),o.a.createElement("hr",{className:"my-2"}),o.a.createElement("p",null,"by Or Givati & Roie Danino"),o.a.createElement("p",{className:"lead"},o.a.createElement(y.a,{to:"/networkBuilder"},o.a.createElement(f.a,{className:"startSimulatingButton"},"Start Simulating")))))}}]),t}(a.Component)),E=(n(353),n(45)),b=(n(355),n(768)),N=n(769),O=n(787),S=(n(357),n(359),n(314)),k=n(763),C=n(764),w=n(765),T=n(766),x=n(767),j=n(32),D=n.n(j),M=function e(){Object(i.a)(this,e);this.baseUrl="http://localhost:8080",this.headers={"Content-Type":"application/json",Accept:"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, GET, DELETE, PUT"}},I=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(l.a)(t,[{key:"createCellType",value:function(e){var t=this.baseUrl+"/build/createCellType/";return D()(t,{method:"POST",body:JSON.stringify(e),headers:this.headers}).then(function(e){return console.log(e),e.json()}).then(function(e){return console.log(e),e}).catch(function(e){return alert(e)})}},{key:"getCellTypes",value:function(){var e=this.baseUrl+"/build/cellTypes";return D()(e,{method:"GET",headers:this.headers}).then(function(e){return e.json()}).then(function(e){return e}).catch(function(e){return alert(e)})}},{key:"deleteCellType",value:function(e){var t=this.baseUrl+"/build/cellTypes/"+e;return D()(t,{method:"DELETE",headers:this.headers}).catch(function(e){return alert(e)})}}]),t}(M),R=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).state={name:"",transformType:"",function:{expression:"",variables:[]}},n.props=e,n.service=new I,n.toggle=e.toggle,n.addCellType=e.addCellType,n}return Object(u.a)(t,e),Object(l.a)(t,[{key:"handleNameChange",value:function(e){this.setState({name:e.target.value})}},{key:"handleExpressionChange",value:function(e){var t=this.state.function;t.expression=e.target.value,this.setState({function:t})}},{key:"handleVariablesChange",value:function(e){var t=this.state.function;t.variables=e.target.value.split(","),this.setState({function:t})}},{key:"handleTransformChange",value:function(e){this.setState({transformType:e})}},{key:"handleSubmit",value:function(e){var t=this;return e.preventDefault(),this.service.createCellType({name:this.state.name,transformType:this.state.transformType.toUpperCase().split(" ").join("_"),createFunctionRequest:this.state.function}).then(function(e){t.addCellType(e),t.toggle()}),e}},{key:"getExpressionIfDefined",value:function(){return this.state.function.expression?this.state.function.expression:" "}},{key:"isActiveTransformType",value:function(e){return e==this.state.transformType}},{key:"render",value:function(){var e=this;return console.log(this.props),o.a.createElement("div",{id:"createCellForm"},o.a.createElement("form",{onSubmit:this.handleSubmit.bind(this)},o.a.createElement(k.a,{className:"title"},"Create A New Cell Type"),o.a.createElement(A,{text:"Name:",value:this.state.name,placeholder:"Example: A",onChange:this.handleNameChange.bind(this)}),o.a.createElement(A,{text:"Function Expression:",value:this.state.function.expression,placeholder:"x + y * z",onChange:this.handleExpressionChange.bind(this)}),o.a.createElement(A,{text:"Variables:",value:this.state.function.variables,placeholder:"x, y, z",onChange:this.handleVariablesChange.bind(this)}),o.a.createElement(C.a,null,o.a.createElement("label",{id:"transformTypeLabel",className:"col-sm-4 col-form-label"},"Transform Type:"),o.a.createElement(w.a,null,["Analog to Analog","Analog to Digital","Digital to Analog","Digital to Digital"].map(function(t){return o.a.createElement(f.a,{active:e.isActiveTransformType(t),onClick:function(n){return e.handleTransformChange(t)}},t)}))),o.a.createElement("div",{id:"blockMath",className:"form-group row"},o.a.createElement("div",{className:"col-sm-10"},o.a.createElement(S.BlockMath,{math:this.getExpressionIfDefined(),errorColor:"#cc0000",renderError:function(e){return o.a.createElement("b",null,"Illegal Expression")}}))),o.a.createElement("button",{className:"btn btn-dark btn-lg btn-block col-sm-11",type:"submit"},"Create Cell Type")))}}]),t}(o.a.Component),A=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).state={text:e.text,placeholder:e.placeholder,onChange:e.onChange,value:e.value},n}return Object(u.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement(C.a,null,o.a.createElement(T.a,{className:"col-form-label"}," ",this.state.text," "),o.a.createElement(x.a,{className:"textField",placeholder:this.state.placeholder,type:"text",onChange:this.state.onChange})))}}]),t}(o.a.Component),B=(n(363),function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.gridSpacing,n=e.gridDotSize;return a.createElement("circle",{className:"circle",cx:(t||0)/2,cy:(t||0)/2,r:n})}}]),t}(a.Component));B.defaultProps={gridDotSize:2,gridSpacing:36};var z=B,F="id",P="special",U="emptyEdge",Z="specialEdge",L=["customEmpty","poly",P,"skinny"],V=[U,Z],H=a.createElement("symbol",{viewBox:"0 0 154 154",width:"154",height:"154",id:"emptyNode"},a.createElement("circle",{cx:"77",cy:"77",r:"76"})),K=a.createElement("symbol",{viewBox:"0 0 100 100",id:"customEmpty"},a.createElement("circle",{cx:"50",cy:"50",r:"45"})),G=a.createElement("symbol",{viewBox:"-27 0 154 154",id:"special",width:"154",height:"154"},a.createElement("rect",{transform:"translate(50) rotate(45)",width:"109",height:"109"})),_=a.createElement("symbol",{viewBox:"0 0 88 72",id:"poly",width:"88",height:"88"},a.createElement("path",{d:"M 0 36 18 0 70 0 88 36 70 72 18 72Z"})),W=a.createElement("symbol",{viewBox:"0 0 154 54",width:"154",height:"54",id:"skinny"},a.createElement("rect",{x:"0",y:"0",rx:"2",ry:"2",width:"154",height:"54"})),J=a.createElement("symbol",{viewBox:"0 0 154 154",id:"specialChild"},a.createElement("rect",{x:"2.5",y:"0",width:"154",height:"154",fill:"rgba(30, 144, 255, 0.12)"})),X={EdgeTypes:{emptyEdge:{shape:a.createElement("symbol",{viewBox:"0 0 50 50",id:"emptyEdge"},a.createElement("circle",{cx:"25",cy:"25",r:"8",fill:"currentColor"})),shapeId:"#emptyEdge"},specialEdge:{shape:a.createElement("symbol",{viewBox:"0 0 50 50",id:"specialEdge"},a.createElement("rect",{transform:"rotate(45)",x:"27.5",y:"-7.5",width:"15",height:"15",fill:"currentColor"})),shapeId:"#specialEdge"}},NodeSubtypes:{specialChild:{shape:J,shapeId:"#specialChild"}},NodeTypes:{emptyNode:{shape:H,shapeId:"#emptyNode",typeText:"None"},empty:{shape:K,shapeId:"#empty",typeText:"None"},special:{shape:G,shapeId:"#special",typeText:"Special"},skinny:{shape:W,shapeId:"#skinny",typeText:"Skinny"},poly:{shape:_,shapeId:"#poly",typeText:"Poly"}}},q=n(109),$=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).state={modal:!1,dragged:0,cellTypes:[],selectedCellType:{},setSelectedType:e.setSelectedType},n.service=new I,n.toggle=n.toggle.bind(Object(E.a)(Object(E.a)(n))),n}return Object(u.a)(t,e),Object(l.a)(t,[{key:"onCreateCellTypeClicked",value:function(e){this.toggle()}},{key:"addCellType",value:function(e){var t=this.state.cellTypes;t.push(e),this.setState({cellTypes:t})}},{key:"toggle",value:function(){this.setState({modal:!this.state.modal})}},{key:"onStart",value:function(){this.setState({dragged:1})}},{key:"onStop",value:function(){this.setState({dragged:0})}},{key:"select",value:function(e){this.setState({selectedCellType:e}),this.state.setSelectedType(e)}},{key:"isSelected",value:function(e){return this.state.selectedCellType.id===e.id}},{key:"componentWillMount",value:function(){var e=this;this.service.getCellTypes().then(function(t){e.setState({cellTypes:t})})}},{key:"render",value:function(){var e=this,t=(this.onStart.bind(this),this.onStop.bind(this),this.state.cellTypes);return o.a.createElement("div",{className:"cellTypePicker"},o.a.createElement("h2",{className:"pickerTitle"},"Cell Types"),o.a.createElement(b.a,{className:"cellTypesList border border-dark"},t.map(function(t,n){var a="cellType"+n;return o.a.createElement(N.a,{key:n,active:e.isSelected(t),onClick:function(){return e.select(t)}},o.a.createElement("div",{className:"cellType",id:a,key:n},o.a.createElement("h6",null,t.name),o.a.createElement("br",null),o.a.createElement("small",null,t.function.expression),o.a.createElement("br",null),o.a.createElement("small",null,t.transformType.replace("_TO_"," \u2192 "))))})),o.a.createElement(O.a,{style:{borderRadius:"4rem"},isOpen:this.state.modal,toggle:this.toggle,className:this.props.className},o.a.createElement(R,{toggle:this.toggle,addCellType:this.addCellType.bind(this)})),o.a.createElement("hr",null),o.a.createElement(f.a,{className:"createCellTypeBtn",onClick:this.onCreateCellTypeClicked.bind(this)},o.a.createElement("svg",{width:"18",height:"22",xmlns:"http://www.w3.org/2000/svg"},o.a.createElement("path",{className:"primary",d:"M8 2v6H2v2h6v6h2v-6h6V8h-6V2H8z",fill:"#ffffff"})),"\xa0 Create a New Cell Type"))}}]),t}(a.Component),Y=n(54),Q=n(80),ee=n(18),te=(n(373),function(){function e(t){Object(i.a)(this,e),this.graphViewProps=t}return Object(l.a)(e,[{key:"calculatePosition",value:function(e){return e}},{key:"adjustNodes",value:function(e,t){for(var n=null,a=0;a<e.length;a++){n=e[a];var o=this.calculatePosition({x:n.x||0,y:n.y||0});n.x=o.x,n.y=o.y}return e}},{key:"getPositionForNode",value:function(e){return this.calculatePosition(e)}}]),e}()),ne=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(l.a)(t,[{key:"calculatePosition",value:function(e){return e}}]),t}(te),ae=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(l.a)(t,[{key:"calculatePosition",value:function(e){var t=e.x,n=e.y,a=this.graphViewProps.gridSpacing,o=(a=a||10)/2,r=t||0,s=n||0;if(t&&(t-o)%a!==0){var i=1;(t-o)%a<o&&(i=-1),r=a*Math.round(t/a)+o*i}if(n&&(n-o)%a!==0){var l=1;(n-o)%a<o&&(l=-1),s=a*Math.round(n/a)+o*l}return{x:r,y:s}}}]),t}(te),oe=n(200),re={None:ne,SnapToGrid:ae,VerticalTree:function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(l.a)(t,[{key:"adjustNodes",value:function(e,t){var n=this.graphViewProps,a=n.nodeKey,o=1.5*(n.nodeSize||1),r=new oe.graphlib.Graph;return r.setGraph({}),r.setDefaultEdgeLabel(function(){return{}}),e.forEach(function(e){if(t){var n=e[a],s="key-".concat(n),i=t[s];0===i.incomingEdges.length&&0===i.outgoingEdges.length||(r.setNode(s,{width:o,height:o}),i.outgoingEdges.forEach(function(e){r.setEdge(s,"key-".concat(e.target))}))}}),oe.layout(r),r.nodes().forEach(function(e){var n=t[e],a=r.node(e);n.node.x=a.x,n.node.y=a.y}),e}}]),t}(ae)},se=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.gridSize,n=e.backgroundFillId;return a.createElement("rect",{className:"background",x:-(t||0)/4,y:-(t||0)/4,width:t,height:t,fill:"url(".concat(n||"",")")})}}]),t}(a.Component);se.defaultProps={backgroundFillId:"#grid",gridSize:40960};var ie=se,le=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.edgeArrowSize;return e||0===e?a.createElement("marker",{id:"end-arrow",key:"end-arrow",viewBox:"0 -".concat(e/2," ").concat(e," ").concat(e),refX:"".concat(e/2),markerWidth:"".concat(e),markerHeight:"".concat(e),orient:"auto"},a.createElement("path",{className:"arrow",d:"M0,-".concat(e/2,"L").concat(e,",0L0,").concat(e/2)})):null}}]),t}(a.Component);le.defaultProps={edgeArrowSize:8};var ce=le,de=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.gridSpacing,n=e.gridDotSize;return a.createElement("pattern",{id:"grid",key:"grid",width:t,height:t,patternUnits:"userSpaceOnUse"},a.createElement(z,{gridSpacing:t,gridDotSize:n}))}}]),t}(a.Component),ue=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return a.createElement("filter",{id:"dropshadow",key:"dropshadow",height:"130%"},a.createElement("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"3"}),a.createElement("feOffset",{dx:"2",dy:"2",result:"offsetblur"}),a.createElement("feComponentTransfer",null,a.createElement("feFuncA",{type:"linear",slope:"0.1"})),a.createElement("feMerge",null,a.createElement("feMergeNode",null),a.createElement("feMergeNode",{in:"SourceGraphic"})))}}]),t}(a.Component),he=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).state={graphConfigDefs:[]},n}return Object(u.a)(t,e),Object(l.a)(t,null,[{key:"getDerivedStateFromProps",value:function(e,n){var a=[];return t.processGraphConfigDefs(e.nodeTypes,a),t.processGraphConfigDefs(e.nodeSubtypes,a),t.processGraphConfigDefs(e.edgeTypes,a),{graphConfigDefs:a}}},{key:"processGraphConfigDefs",value:function(e,t){Object.keys(e).forEach(function(n){var o=e[n].shapeId?e[n].shapeId.replace("#",""):"graphdef";t.push(a.cloneElement(e[n].shape,{key:"".concat(o,"-").concat(t.length+1)}))})}}]),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.edgeArrowSize,n=e.gridSpacing,o=e.gridDotSize;return a.createElement("defs",null,this.state.graphConfigDefs,a.createElement(ce,{edgeArrowSize:t}),a.createElement(de,{gridSpacing:n,gridDotSize:o}),a.createElement(ue,null),this.props.renderDefs&&this.props.renderDefs())}}]),t}(a.Component);he.defaultProps={gridDotSize:2,renderDefs:function(){return null}};var pe=he,ge=n(206),me=(n(755),n(69)),fe=n(38),ye=n(315),ve=function(){function e(){Object(i.a)(this,e)}return Object(l.a)(e,null,[{key:"getNodesMap",value:function(e,t){for(var n={},a=null,o=0;o<e.length;o++)a=e[o],n["key-".concat(a[t])]={children:[],incomingEdges:[],node:a,originalArrIndex:o,outgoingEdges:[],parents:[]};return n}},{key:"getEdgesMap",value:function(e){for(var t={},n=null,a=0;a<e.length;a++)(n=e[a]).target&&(t["".concat(n.source||"","_").concat(n.target)]={edge:n,originalArrIndex:a});return t}},{key:"linkNodesAndEdges",value:function(e,t){for(var n=null,a=null,o=null,r=0;r<t.length;r++)(o=t[r]).target&&(n=e["key-".concat(o.source||"")],a=e["key-".concat(o.target)],n&&a&&(n.outgoingEdges.push(o),a.incomingEdges.push(o),n.children.push(a),a.parents.push(n)))}},{key:"removeElementFromDom",value:function(e){var t=document.getElementById(e);return!(!t||!t.parentNode)&&(t.parentNode.removeChild(t),!0)}},{key:"findParent",value:function(t,n){return t&&null!=t&&t.matches&&null!=t.matches&&t.matches(n)?t:t&&null!=t&&null!=t.parentNode&&t.parentNode?e.findParent(t.parentNode,n):null}},{key:"classNames",value:function(){for(var e="",t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];for(var o=0;o<n.length;o++){var r=n[o];"string"===typeof r||"number"===typeof r?e+=" ".concat(r):"object"!==typeof r||Array.isArray(r)||null===r?Array.isArray(r)&&(e+=" ".concat(r.join(" "))):e=this.updateClassNames(r,e)}return e.trim()}},{key:"updateClassNames",value:function(e,t){return Object.keys(e).forEach(function(n){Boolean(e[n])&&(t+=" ".concat(n))}),t}},{key:"yieldingLoop",value:function(e,t,n,a){var o=0;!function r(){for(var s=Math.min(o+t,e);o<s;++o)n.call(null,o);o<e?setTimeout(r,0):a&&a.call(null)}()}},{key:"hasNodeShallowChanged",value:function(e,t){for(var n=Object.keys(e),a=Object.keys(e),o={},r=0;r<n.length;r++){var s=n[r];if(!t.hasOwnProperty(s)||e[s]!==t[s])return!0;o[s]=!0}for(var i=0;i<a.length;i++){var l=a[i];if(!o[l]&&(!e.hasOwnProperty(l)||e[l]!==t[l]))return!0}return!1}}]),e}(),Ee=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).getEdgeHandleTranslation=function(){var e=n.props,t=(e.nodeSize,e.nodeKey,e.sourceNode,e.targetNode,e.data),a=n.getPathDescription(t),o=(a=(a=a.replace(/^M/,"")).replace(/L/,",")).split(","),r=parseFloat(o[2])-parseFloat(o[0]),s=parseFloat(o[3])-parseFloat(o[1]),i=parseFloat(o[0])+r/2,l=parseFloat(o[1])+s/2;return"translate(".concat(i,", ").concat(l,")")},n.getEdgeHandleOffsetTranslation=function(){var e=-(n.props.edgeHandleSize||0)/2;return"translate(".concat(e,", ").concat(e,")")},n.getEdgeHandleRotation=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=!1,o=n.props.sourceNode,r=n.props.targetNode,s=180*t.getTheta(o,r)/Math.PI;return e&&(s=-s),(s>90||s<-90)&&(s+=180,a=!0),["rotate(".concat(s,")"),a]},n.getEdgeHandleTransformation=function(){var e=n.getEdgeHandleTranslation(),t=n.getEdgeHandleRotation(),a=Object(ge.a)(t,1)[0],o=n.getEdgeHandleOffsetTranslation();return"".concat(e," ").concat(a," ").concat(o)},n.edgeOverlayRef=a.createRef(),n}return Object(u.a)(t,e),Object(l.a)(t,null,[{key:"getTheta",value:function(e,t){var n=(t.x||0)-(e.x||0),a=(t.y||0)-(e.y||0);return Math.atan2(a,n)}},{key:"lineFunction",value:function(e){return ee.c().x(function(e){return e.x}).y(function(e){return e.y})(e)}},{key:"getArrowSize",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:document).querySelector("defs>marker>.arrow").getBoundingClientRect()}},{key:"getEdgePathElement",value:function(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:document).querySelector("#edge-".concat(e.source,"-").concat(e.target,"-container>.edge-container>.edge>.edge-path"))}},{key:"parsePathToXY",value:function(e){var t={source:{x:0,y:0},target:{x:0,y:0}};if(e){var n=e.getAttribute("d"),a=(n=(n=n&&n.replace(/^M/,""))&&n.replace(/L/,","))&&n.split(",")||[];4===(a=a.map(function(e){return parseFloat(e)})).length&&(t.source.x=a[0],t.source.y=a[1],t.target.x=a[2],t.target.y=a[3])}return t}},{key:"getDefaultIntersectResponse",value:function(){return{xOff:0,yOff:0,intersect:{type:"none",point:{x:0,y:0}}}}},{key:"getRotatedRectIntersect",value:function(e,n,a,o){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:document,s=t.getDefaultIntersectResponse(),i=t.getArrowSize(r),l=e.getBoundingClientRect(),c=e.getAttribute("width"),d=e.getAttribute("height"),u=c?parseFloat(c):l.width,h=d?parseFloat(d):l.height,p=a.x||0,g=a.y||0,m=n.x||0,f=n.y||0,y=g-h/2,v=g+h/2,E=p-u/2,b=p+u/2,N=Object(me.shape)("line",{x1:m,y1:f,x2:p,y2:g}),O={topLeft:new fe.Point2D(E,y),bottomRight:new fe.Point2D(b,v)},S=[O.topLeft,new fe.Point2D(O.bottomRight.x,O.topLeft.y),O.bottomRight,new fe.Point2D(O.topLeft.x,O.bottomRight.y)],k=O.topLeft.lerp(O.bottomRight,.5),C=e.getAttribute("transform"),w=C?C.replace(/(rotate.[0-9]*.)|[^]/g,"$1"):null,T=0;w&&(w=w.replace(/^rotate\(|\)$/g,""),T=parseFloat(w)*Math.PI/180);var x=fe.Matrix2D.rotationAt(T,k),j=S.map(function(e){return e.transform(x)}),D=ye.Intersection.intersectLinePolygon(N.params[0],N.params[1],j);if(D.points.length>0){var M=0,I=0,R=D.points[0].x,A=D.points[0].y;R>E&&R<b&&A>g?I=i.height:R>E&&R<b&&A<g?I=-i.height:M=A>y&&A<v&&R<p?-i.width:i.width,s.xOff=p-R-(o?M/1.25:0),s.yOff=g-A-(o?I/1.25:0),s.intersect=D.points[0]}return s}},{key:"getPathIntersect",value:function(e,n,a){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:document,s=t.getDefaultIntersectResponse(),i=t.getArrowSize(r),l=e.getBoundingClientRect(),c=l.width,d=l.height,u=a.x||0,h=a.y||0,p=n.x||0,g=n.y||0,m=h-d/2,f=h+d/2,y=u-c/2,v=u+c/2,E=e.getAttribute("d");if(/^M/.test(E)){var b=(E=E.replace(/^M /,"")).split(" ");b=b.map(function(e,t){var n=!1;return/Z$/.test(e)&&(e=e.replace(/Z$/,""),n=!0),t%2===0?parseFloat(e)+y+(n?"Z":""):parseFloat(e)+m+(n?"Z":"")});var N=Object(me.intersect)(Object(me.shape)("path",{d:"M "+b.join(" ")}),Object(me.shape)("line",{x1:p,y1:g,x2:u,y2:h}));if(N.points.length>0){var O=0,S=0,k=N.points[0].x,C=N.points[0].y,w=1;if(k>y&&k<v){var T=C-h;w=C<h?-1:1,S=i.height*w,S*=Math.min(Math.abs(T),1)}if(C>m&&C<f){var x=k-u;w=k<u?-1:1,O=i.width*w,O*=Math.min(Math.abs(x),1)}s.xOff=u-k-(o?O/1.25:0),s.yOff=h-C-(o?S/1.25:0),s.intersect=N.points[0]}return s}}},{key:"getCircleIntersect",value:function(e,n,a){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:document,s=t.getDefaultIntersectResponse(),i=t.getArrowSize(r),l=i.width,c=i.height,d=e.getBoundingClientRect(),u=e.parentElement,h=u.getAttribute("width"),p=u.getAttribute("width");h&&(h=parseFloat(h)),p&&(p=parseFloat(p));var g=h||d.width,m=p||d.height,f=a.x||0,y=a.y||0,v=n.x||0,E=n.y||0,b=g/2+(o?l/1.25:0),N=m/2+(o?c/1.25:0),O=Object(me.intersect)(Object(me.shape)("ellipse",{rx:b,ry:N,cx:f,cy:y}),Object(me.shape)("line",{x1:v,y1:E,x2:f,y2:y}));if(O.points.length>0){var S=O.points[0].x,k=O.points[0].y;s.xOff=f-S,s.yOff=y-k,s.intersect=O.points[0]}return s}},{key:"calculateOffset",value:function(e,n,a,o){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:document,i=t.getDefaultIntersectResponse();if(!a[o])return i;var l=document.getElementById("node-".concat(a[o]));if(!l)return i;var c=l.querySelector("use.node");if(!c||c&&!c.getAttributeNS)return i;var d=c.getAttributeNS("http://www.w3.org/1999/xlink","href");if(!d)return i;var u=s.querySelector("defs>".concat(d," rect")),h=h?null:s.querySelector("defs>".concat(d," path")),p=h||h?null:s.querySelector("defs>".concat(d," circle, defs>").concat(d," ellipse, defs>").concat(d," polygon"));return i=u?Object(Y.a)({},i,t.getRotatedRectIntersect(u,n,a,r,s)):h?Object(Y.a)({},i,t.getPathIntersect(h,n,a,r,s)):Object(Y.a)({},i,t.getCircleIntersect(p,n,a,r,s))}},{key:"getXlinkHref",value:function(e,t){return t.type&&e[t.type]?e[t.type].shapeId:e.emptyEdge?e.emptyEdge.shapeId:null}}]),Object(l.a)(t,[{key:"getPathDescription",value:function(e){var n=this.props,a=n.sourceNode,o=n.targetNode,r=n.nodeKey,s=n.nodeSize,i=n.viewWrapperElem,l=o&&o.x?o.x:0,c=o&&o.y?o.y:0,d=o&&a.x?a.x:0,u=o&&a.y?a.y:0,h=t.calculateOffset(s||0,o,a,r,!1,i),p=t.calculateOffset(s||0,a,o,r,!0,i),g=[{x:d-h.xOff,y:u-h.yOff},{x:l-p.xOff,y:c-p.yOff}];return t.lineFunction(g)}},{key:"renderHandleText",value:function(e){return a.createElement("text",{className:"edge-text",textAnchor:"middle",alignmentBaseline:"central",transform:"".concat(this.getEdgeHandleTranslation())},e.handleText)}},{key:"renderLabelText",value:function(e){var t=this.getEdgeHandleRotation(),n=Object(ge.a)(t,2),o=n[0],r=n[1]?"".concat(e.label_to," \u2194 ").concat(e.label_from):"".concat(e.label_from," \u2194 ").concat(e.label_to);return a.createElement("text",{className:"edge-text",textAnchor:"middle",alignmentBaseline:"central",style:{fontSize:"11px",stroke:"none",fill:"black"},transform:"".concat(this.getEdgeHandleTranslation()," ").concat(o," translate(0,-5)")},r)}},{key:"render",value:function(){var e=this.props,n=e.data,o=e.edgeTypes,r=e.edgeHandleSize;if(!e.viewWrapperElem)return null;var s="".concat(n.source||"","_").concat(n.target),i=ve.classNames("edge",{selected:this.props.isSelected});return a.createElement("g",{className:"edge-container","data-source":n.source,"data-target":n.target},a.createElement("g",{className:i},a.createElement("path",{className:"edge-path",d:this.getPathDescription(n)||void 0}),a.createElement("use",{xlinkHref:t.getXlinkHref(o,n),width:r,height:r,transform:"".concat(this.getEdgeHandleTransformation())}),n.handleText&&this.renderHandleText(n),n.label_from&&n.label_to&&this.renderLabelText(n)),a.createElement("g",{className:"edge-mouse-handler"},a.createElement("path",{className:"edge-overlay-path",ref:this.edgeOverlayRef,id:s,"data-source":n.source,"data-target":n.target,d:this.getPathDescription(n)||void 0})))}}]),t}(a.Component);Ee.defaultProps={edgeHandleSize:50,isSelected:!1};var be=Ee,Ne=n(351),Oe=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).zoom=function(e){var t=n.props,a=t.minZoom,o=t.maxZoom,r=e.target.value,s=n.sliderToZoom(r),i=s-n.props.zoomLevel;s<=(o||0)&&s>=(a||0)&&n.props.modifyZoom(i)},n}return Object(u.a)(t,e),Object(l.a)(t,[{key:"sliderToZoom",value:function(e){var t=this.props,n=t.minZoom;return e*((t.maxZoom||0)-(n||0))/100+(n||0)}},{key:"zoomToSlider",value:function(e){var t=this.props,n=t.minZoom;return 100*(e-(n||0))/((t.maxZoom||0)-(n||0))}},{key:"render",value:function(){return o.a.createElement("div",{className:"graph-controls"},o.a.createElement("div",{className:"slider-wrapper"},o.a.createElement("span",null,"-"),o.a.createElement("input",{type:"range",className:"slider",min:this.zoomToSlider(this.props.minZoom||0),max:this.zoomToSlider(this.props.maxZoom||0),value:this.zoomToSlider(this.props.zoomLevel),onChange:this.zoom,step:"1"}),o.a.createElement("span",null,"+")),o.a.createElement("button",{type:"button",className:"slider-button",onMouseDown:this.props.zoomToFit},o.a.createElement(Ne.a,null)))}}]),t}(o.a.Component);Oe.defaultProps={maxZoom:1.5,minZoom:.15};var Se=Oe,ke=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).state={data:e.data},n}return Object(u.a)(t,e),Object(l.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.data;t.instance=e.data.instance,this.setState({data:t})}},{key:"getTypeText",value:function(){return this.state.data.instance?this.state.data.instance.cellType.name:""}},{key:"getIdText",value:function(){return this.state.data.instance?this.state.data.instance.id:""}},{key:"render",value:function(){var e=this.props,t=e.data,n=(e.nodeTypes,e.isSelected),o=this.getIdText(),r=t.instance&&"INPUT"!==t.instance.cellType.inputType?t.title:"",s=ve.classNames("node-text",{selected:n}),i=this.getTypeText();return a.createElement("text",{className:s,textAnchor:"middle"},!!i&&a.createElement("tspan",{opacity:"0.5"},i),r&&a.createElement("tspan",{x:0,dy:20,fontSize:"10px"},r),r&&a.createElement("title",null,r),o&&a.createElement("tspan",{x:0,dy:26,opacity:"0.4"},o,a.createElement("br",null)))}}]),t}(a.Component),Ce=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).handleMouseMove=function(){var e=1===ee.b.sourceEvent.buttons,t=ee.b.sourceEvent.shiftKey,a=n.props,o=a.nodeSize,r=a.layoutEngine,s=a.nodeKey,i=a.viewWrapperElem;if(e){var l={x:ee.b.x,y:ee.b.y};if(t){n.setState({drawingEdge:!0});var c=be.calculateOffset(o,n.props.data,l,s,!0,i);l.x+=c.xOff,l.y+=c.yOff}else!n.state.drawingEdge&&r&&Object.assign(l,r.getPositionForNode(l));n.setState(l),n.props.onNodeMove(l,n.props.data[s],t)}},n.handleDragStart=function(){n.nodeRef.current&&(n.oldSibling||(n.oldSibling=n.nodeRef.current.parentElement.nextSibling),n.nodeRef.current.parentElement.parentElement.appendChild(n.nodeRef.current.parentElement))},n.handleDragEnd=function(){if(n.nodeRef.current){var e=n.state,t=e.x,a=e.y,o=e.drawingEdge,r=n.props,s=r.data,i=(r.index,r.nodeKey);n.setState({mouseDown:!1,drawingEdge:!1}),n.oldSibling&&n.oldSibling.parentElement&&n.oldSibling.parentElement.insertBefore(n.nodeRef.current.parentElement,n.oldSibling);var l=ee.b.sourceEvent.shiftKey;n.props.onNodeUpdate({x:t,y:a},s[i],l||o),n.props.onNodeSelected(s,s[i],l||o)}},n.handleMouseOver=function(e){var t=!1;(ee.b&&1!==ee.b.buttons||e&&1!==e.buttons)&&(t=!0,n.setState({hovered:t})),n.props.onNodeMouseEnter(e,n.props.data,t)},n.handleMouseOut=function(e){n.setState({hovered:!1}),n.props.onNodeMouseLeave(e,n.props.data)},n.state={drawingEdge:!1,hovered:!1,mouseDown:!1,selected:!1,x:e.data.x||0,y:e.data.y||0},n.nodeRef=a.createRef(),n}return Object(u.a)(t,e),Object(l.a)(t,null,[{key:"getDerivedStateFromProps",value:function(e,t){return{selected:e.isSelected,x:e.data.x,y:e.data.y}}}]),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=ee.a().on("drag",this.handleMouseMove).on("start",this.handleDragStart).on("end",this.handleDragEnd);ee.e(this.nodeRef.current).on("mouseout",this.handleMouseOut).call(e)}},{key:"renderShape",value:function(){var e=this.props,n=e.renderNode,o=e.data,r=e.index,s=e.nodeTypes,i=e.nodeSubtypes,l=e.nodeKey,c=this.state,d=c.hovered,u=c.selected,h={height:this.props.nodeSize||0,width:this.props.nodeSize||0},p=ve.classNames("shape"),g=ve.classNames("node",{selected:u,hovered:d}),m=ve.classNames("subtype-shape",{selected:this.state.selected}),f=t.getNodeTypeXlinkHref(o,s)||"",y=t.getNodeSubtypeXlinkHref(o,i)||"",v=f?document.querySelector("defs>".concat(f)):null,E=v?v.getAttribute("width"):0,b=v?v.getAttribute("height"):0;return h.width=E?parseInt(E,10):h.width,h.height=b?parseInt(b,10):h.height,n?n(this.nodeRef,o,o[l],u,d):a.createElement("g",Object.assign({className:p},h),!!o.subtype&&a.createElement("use",{"data-index":r,className:m,x:-h.width/2,y:-h.height/2,width:h.width,height:h.height,xlinkHref:y}),a.createElement("use",{"data-index":r,className:g,x:-h.width/2,y:-h.height/2,width:h.width,height:h.height,xlinkHref:f}))}},{key:"renderText",value:function(){var e=this.props,t=e.data,n=(e.index,e.id),o=e.nodeTypes,r=e.renderNodeText,s=e.isSelected;return r?r(t,n,s):a.createElement(ke,{data:t,nodeTypes:o,isSelected:this.state.selected})}},{key:"render",value:function(){var e=this.state,t=e.x,n=e.y,o=e.hovered,r=e.selected,s=this.props,i=s.opacity,l=s.id,c=s.data,d=ve.classNames("node",c.type,{hovered:o,selected:r});return a.createElement("g",{className:d,onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,id:l,ref:this.nodeRef,opacity:i,transform:"translate(".concat(t,", ").concat(n,")")},this.renderShape(),this.renderText())}}],[{key:"getNodeTypeXlinkHref",value:function(e,t){return e.type&&t[e.type]?t[e.type].shapeId:t.emptyNode?t.emptyNode.shapeId:null}},{key:"getNodeSubtypeXlinkHref",value:function(e,t){return e.subtype&&t&&t[e.subtype]?t[e.subtype].shapeId:t&&t.emptyNode?t.emptyNode.shapeId:null}}]),t}(a.Component);Ce.defaultProps={isSelected:!1,nodeSize:154,onNodeMouseEnter:function(){},onNodeMouseLeave:function(){},onNodeMove:function(){},onNodeSelected:function(){},onNodeUpdate:function(){}};var we=Ce,Te=(n(560),function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(d.a)(t).call(this))}return Object(u.a)(t,e),Object(l.a)(t,[{key:"addCellInstance",value:function(e,t,n){var a=this.baseUrl+"/build/addCell/";return D()(a,{method:"POST",body:JSON.stringify({cellTypeId:e.id,x:t,y:n}),headers:this.headers}).then(function(e){return console.log(e),e.json()}).then(function(e){return console.log(e),e}).catch(function(e){return alert(e)})}},{key:"connectCells",value:function(e,t,n,a){var o=this.baseUrl+"/build/connect/";return D()(o,{method:"POST",body:JSON.stringify({sourceCell:e,destinationCell:t,delay:n,inputFunctionVariable:a}),headers:this.headers}).then(function(e){return e.json()}).then(function(e){return e}).catch(function(e){return alert(e)})}},{key:"areCompatible",value:function(e,t){var n=this.baseUrl+"/build/areCompatible?srcTransform="+e.cellType.transformType+"&destTransform="+t.cellType.transformType;return D()(n,{method:"GET",headers:this.headers}).then(function(e){return e.json()}).then(function(e){return e}).catch(function(e){return alert(e)})}},{key:"getCellInstances",value:function(){var e=this.baseUrl+"/build/cellInstances/";return D()(e,{method:"GET",headers:this.headers}).then(function(e){return e.json()}).then(function(e){return e}).catch(function(e){return alert(e)})}},{key:"getInputCells",value:function(){var e=this.baseUrl+"/build/inputCells/";return D()(e,{method:"GET",headers:this.headers}).then(function(e){return e.json()}).then(function(e){return e}).catch(function(e){return alert(e)})}},{key:"getConnections",value:function(){var e=this.baseUrl+"/build/connections/";return D()(e,{method:"GET",headers:this.headers}).then(function(e){return console.log(e),e.json()}).then(function(e){return console.log(e),e}).catch(function(e){return alert(e)})}},{key:"updateCellLocation",value:function(e,t,n){var a=this.baseUrl+"/build/updateCellLocation/"+t+"/"+n+"/";return D()(a,{method:"PUT",headers:this.headers,body:JSON.stringify(e)}).catch(function(e){return alert(e)})}},{key:"deleteCellInstance",value:function(e){var t=this.baseUrl+"/build/cellInstances/"+e;return D()(t,{method:"DELETE",headers:this.headers}).catch(function(e){return alert(e)})}},{key:"deleteConnection",value:function(e){var t=this.baseUrl+"/build/connections/"+e;return D()(t,{method:"DELETE",headers:this.headers}).catch(function(e){return alert(e)})}}]),t}(M)),xe=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).removeOldEdges=function(e,t){for(var a=null,o=0;o<e.length;o++)(a=e[o]).source&&a.target&&t["".concat(a.source,"_").concat(a.target)]||n.removeEdgeElement(a.source,a.target)},n.handleDelete=function(e){var t=n.props,a=t.canDeleteNode,o=t.canDeleteEdge;!t.readOnly&&e&&(!e.source&&a&&a(e)?n.deleteNode(e):e.source&&o&&o(e)&&n.deleteEdge(e))},n.handleWrapperKeydown=function(e){var t=n.props,a=t.selected,o=t.onUndo,r=t.onCopySelected,s=t.onPasteSelected,i=n.state,l=i.focused,c=i.selectedNodeObj;if(l)switch(e.key){case"Delete":case"Backspace":c&&n.handleDelete(c.node||a);break;case"z":(e.metaKey||e.ctrlKey)&&o&&o();break;case"c":(e.metaKey||e.ctrlKey)&&c.node&&r&&r();break;case"v":(e.metaKey||e.ctrlKey)&&c.node&&s&&s()}},n.handleEdgeSelected=function(e){var t=e.target.dataset,a=t.source,o=t.target,r={svgClicked:!0,focused:!0};if(a&&o){if(!n.getEdgeBySourceTarget(a,o))return;var s=n.getEdgeBySourceTarget(a,o).originalArrIndex;n.state.selectedEdgeObj&&n.state.selectedEdgeObj.edge;r=Object(Y.a)({},r,{selectedEdgeObj:{componentUpToDate:!1,edge:n.state.edges[s]}}),n.setState(r),n.props.onSelectEdge(n.state.edges[s])}else n.setState(r)},n.handleSvgClicked=function(e,t){if(n.isPartOfEdge(ee.b.target))n.handleEdgeSelected(ee.b);else if(n.state.selectingNode)n.setState({focused:!0,selectingNode:!1,svgClicked:!0});else{var a=n.state.selectedNodeObj&&n.state.selectedNodeObj.node||null;n.state.selectedNodeObj&&n.state.selectedNodeObj.index;if(n.setState({selectedNodeObj:null,focused:!0,svgClicked:!0}),n.props.onSelectNode(null),a&&n.syncRenderNode(a),!n.props.readOnly&&ee.b.shiftKey){var o=ee.d(ee.b.target);n.props.onCreateNode(o[0],o[1],ee.b)}}},n.handleDocumentClick=function(e){e&&e.target&&null!=e.target.ownerSVGElement&&e.target.ownerSVGElement===n.graphSvg.current||n.setState({documentClicked:!0,focused:!1,svgClicked:!1})},n.handleNodeMove=function(e,t,a){var o=n.props,r=(o.nodeKey,o.canCreateEdge),s=o.readOnly,i=n.getNodeById(t);if(i){var l=i.node;(new Te).updateCellLocation(l.instance,e.x,e.y),s||(a||n.state.draggingEdge?(r&&r(t)||n.state.draggingEdge)&&(n.syncRenderEdge({source:t,targetPosition:e}),n.setState({draggingEdge:!0})):(l.x=e.x,l.y=e.y,n.renderConnectedEdgesFromNode(i,!0),n.asyncRenderNode(l)))}},n.handleNodeUpdate=function(e,t,a){var o=n.props,r=o.onUpdateNode;if(!o.readOnly){if(a)n.createNewEdge();else{var s=n.getNodeById(t);s&&(Object.assign(s.node,e),r(s.node))}n.setState({componentUpToDate:!1,focused:!0,hoveredNode:!1,svgClicked:!0})}},n.handleNodeMouseEnter=function(e,t,a){a&&!n.state.hoveredNode?n.setState({hoveredNode:!0,hoveredNodeData:t}):!a&&n.state.hoveredNode&&n.state.draggingEdge?n.setState({edgeEndNode:t}):n.setState({hoveredNode:!0,hoveredNodeData:t})},n.handleNodeMouseLeave=function(e,t){if(null!=ee.b&&null!=ee.b.toElement&&null!=e&&null!=e.relatedTarget&&!(ee.b&&ee.b.toElement&&ve.findParent(ee.b.toElement,".node")||e&&e.relatedTarget&&ve.findParent(e.relatedTarget,".node")||ee.b&&1===ee.b.buttons||e&&1===e.buttons)&&e&&e.relatedTarget){if(e.relatedTarget.classList.contains("edge-overlay-path"))return;n.setState({hoveredNode:!1,edgeEndNode:null})}},n.handleNodeSelected=function(e,t,a){n.state.selectedNodeObj&&n.state.selectedNodeObj.node&&n.state.selectedNodeObj.index;var o={componentUpToDate:!1,selectedNodeObj:{nodeId:t,node:e}};n.setState(o),a||n.props.onSelectNode(e)},n.handleZoomStart=function(){var e=ee.b.sourceEvent;if(n.props.readOnly||!e||e&&!e.buttons||e&&!e.target.classList.contains("edge-overlay-path"))return!1;var t=e.target.id,a=n.state.edgesMap&&n.state.edgesMap[t]?n.state.edgesMap[t].edge:null;if(!n.isArrowClicked(a)||!a)return!1;n.removeEdgeElement(a.source,a.target),n.setState({draggingEdge:!0,draggedEdge:a}),n.dragEdge(a)},n.handleZoom=function(){var e=n.state,t=e.draggingEdge,a=(e.draggedEdge,e.hoveredNode,ee.b.transform);if(t){if(t)return n.dragEdge(),!1}else ee.e(n.view).attr("transform",a),n.state.viewTransform!==a&&n.setState({viewTransform:a,draggedEdge:null,draggingEdge:!1},function(){n.renderGraphControls()})},n.handleZoomEnd=function(){var e=n.state,t=e.draggingEdge,a=e.draggedEdge,o=e.edgeEndNode,r=(e.edgesMap,n.props.nodeKey);if(t&&a){var s=Object(Y.a)({},n.state.draggedEdge);ve.removeElementFromDom("edge-custom-container"),n.setState({draggedEdge:null,draggingEdge:!1,hoveredNode:!1},function(){var e=n.getNodeById(a.source),t=n.getNodeById(a.target);if(e&&t){var i=e.node;o&&!n.getEdgeBySourceTarget(a.source,o[r])&&n.canSwap(i,o,a)?(s.target=o[r],n.syncRenderEdge(s),n.props.onSwapEdge(e.node,o,a)):n.syncRenderEdge(a)}})}else t&&!a&&n.setState({draggingEdge:!1})},n.handleZoomToFit=function(){var e=ee.e(n.viewWrapper.current).node(),t=ee.e(n.entities).node(),a=t.getBBox?t.getBBox():null;if(a){var o=e.clientWidth,r=e.clientHeight,s=n.props.minZoom||0,i=n.props.maxZoom||2,l={k:(s+i)/2,x:0,y:0};if(a.width>0&&a.height>0){var c=a.width,d=a.height,u=a.x+a.width/2,h=a.y+a.height/2;l.k=.9/Math.max(c/o,d/r),l.k<s?l.k=s:l.k>i&&(l.k=i),l.x=o/2-l.k*u,l.y=r/2-l.k*h}n.setZoom(l.k,l.x,l.y,n.props.zoomDur)}},n.modifyZoom=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=ee.e(n.viewWrapper.current).node(),s=r.clientWidth/2,i=r.clientHeight/2,l=n.zoom.scaleExtent(),c=n.state.viewTransform,d={k:c.k,x:c.x,y:c.y},u=d.k*(1+e);if(d.k=u,u<l[0]||u>l[1])return!1;var h=(s-d.x)/d.k,p=(i-d.y)/d.k,g=h*d.k+d.x,m=p*d.k+d.y;return d.x+=s-g+t,d.y+=i-m+a,n.setZoom(d.k,d.x,d.y,o),!0},n.renderBackground=function(){var e=n.props,t=e.gridSize,o=e.backgroundFillId,r=e.renderBackground;return r?r(t):a.createElement(ie,{gridSize:t,backgroundFillId:o})},n.getNodeComponent=function(e,t){var o=n.props,r=o.nodeTypes,s=o.nodeSubtypes,i=o.nodeSize,l=o.renderNode,c=o.renderNodeText,d=o.nodeKey;return a.createElement(we,{key:e,id:e,data:t,nodeTypes:r,nodeSize:i,nodeKey:d,nodeSubtypes:s,onNodeMouseEnter:n.handleNodeMouseEnter,onNodeMouseLeave:n.handleNodeMouseLeave,onNodeMove:n.handleNodeMove,onNodeUpdate:n.handleNodeUpdate,onNodeSelected:n.handleNodeSelected,renderNode:l,renderNodeText:c,isSelected:n.state.selectedNodeObj.node===t,layoutEngine:n.layoutEngine,viewWrapperElem:n.viewWrapper.current})},n.renderNodes=function(){n.entities&&n.state.nodes.forEach(function(e,t){n.asyncRenderNode(e)})},n.isEdgeSelected=function(e){return!!n.state.selectedEdgeObj&&!!n.state.selectedEdgeObj.edge&&n.state.selectedEdgeObj.edge.source===e.source&&n.state.selectedEdgeObj.edge.target===e.target},n.getEdgeComponent=function(e){var t=n.getNodeById(e.source),o=t?t.node:null,r=n.getNodeById(e.target),s=r?r.node:null,i=e.targetPosition,l=n.props,c=l.edgeTypes,d=l.edgeHandleSize,u=l.nodeSize,h=l.nodeKey;return a.createElement(be,{data:e,edgeTypes:c,edgeHandleSize:d,nodeSize:u,sourceNode:o,targetNode:s||i,nodeKey:h,viewWrapperElem:n.viewWrapper.current,isSelected:n.isEdgeSelected(e)})},n.renderEdge=function(e,t,a){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!n.entities)return null;var r="".concat(e,"-container"),i="".concat(e,"-custom-container"),l=n.state.draggedEdge,c=n.props.afterRenderEdge,d=document.getElementById(r);if(o&&d)d.style.display="none",r="".concat(e,"-custom-container"),d=document.getElementById(r);else if(d){var u=document.getElementById(i);d.style.display="",u&&u.remove()}if(!d&&a!==l){var h=document.createElementNS("http://www.w3.org/2000/svg","g");h.id=r,n.entities.appendChild(h),d=h}return d&&(s.a.render(t,d),c)?c(e,t,a,d,n.isEdgeSelected(a)):void 0},n.asyncRenderEdge=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.source&&e.target){var a="edges-".concat(e.source,"-").concat(e.target);cancelAnimationFrame(n.edgeTimeouts[a]),n.edgeTimeouts[a]=requestAnimationFrame(function(){n.syncRenderEdge(e,t)})}},n.renderEdges=function(){var e=n.state,t=e.edges,a=e.draggingEdge;if(n.entities&&!a)for(var o=0;o<t.length;o++)n.asyncRenderEdge(t[o])},n.nodeTimeouts={},n.edgeTimeouts={},n.renderNodesTimeout=null,n.renderEdgesTimeout=null,n.viewWrapper=a.createRef(),n.graphControls=a.createRef(),n.graphSvg=a.createRef(),n.service=n.props.service,e.layoutEngineType&&(n.layoutEngine=new re[e.layoutEngineType](e)),n.state={componentUpToDate:!1,draggedEdge:null,draggingEdge:!1,edgeEndNode:null,edges:[],edgesMap:{},hoveredNode:!1,hoveredNodeData:null,nodes:[],nodesMap:{},selectedEdgeObj:null,selectedNodeObj:null,selectingNode:!1,documentClicked:!1,svgClicked:!1,focused:!0},n}return Object(u.a)(t,e),Object(l.a)(t,null,[{key:"getDerivedStateFromProps",value:function(e,t){var n=e.edges,a=e.nodeKey,o=e.nodes,r=ve.getNodesMap(o,a),s=ve.getEdgesMap(n);ve.linkNodesAndEdges(r,n);var i=e.selected&&r["key-".concat(e.selected[a])]?r["key-".concat(e.selected[a])]:null,l=e.selected&&s["".concat(e.selected.source,"_").concat(e.selected.target)]?s["".concat(e.selected.source,"_").concat(e.selected.target)]:null;0===t.nodes.length&&e.layoutEngineType&&re[e.layoutEngineType]&&(o=new re[e.layoutEngineType](e).adjustNodes(o,r));return{componentUpToDate:!0,edges:n,edgesMap:s,nodes:o,nodesMap:r,readOnly:e.readOnly,selectedEdgeObj:{edge:l?l.edge:null},selectedNodeObj:{nodeId:i?e.selected[a]:null,node:i?i.node:null},selectionChanged:!1}}}]),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;document.addEventListener("keydown",this.handleWrapperKeydown),document.addEventListener("click",this.handleDocumentClick),this.zoom=ee.f().filter(this.zoomFilter).scaleExtent([this.props.minZoom||0,this.props.maxZoom||0]).on("start",this.handleZoomStart).on("zoom",this.handleZoom).on("end",this.handleZoomEnd),ee.e(this.viewWrapper.current).on("touchstart",this.containZoom).on("touchmove",this.containZoom).on("click",this.handleSvgClicked).select("svg").call(this.zoom),this.selectedView=ee.e(this.view),this.renderView(),setTimeout(function(){null!=e.viewWrapper&&e.handleZoomToFit()},this.props.zoomDelay)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleWrapperKeydown),document.removeEventListener("click",this.handleDocumentClick)}},{key:"shouldComponentUpdate",value:function(e,t){return e.nodes!==this.props.nodes||e.edges!==this.props.edges||!t.componentUpToDate||e.selected!==this.props.selected||e.readOnly!==this.props.readOnly||e.layoutEngineType!==this.props.layoutEngineType}},{key:"componentDidUpdate",value:function(e,t){var n=this.state,a=n.nodesMap,o=n.edgesMap,r=n.nodes,s=n.selectedNodeObj,i=n.selectedEdgeObj,l=this.props.layoutEngineType;if(l&&re[l]){this.layoutEngine=new re[this.props.layoutEngineType](this.props);var c=this.layoutEngine.adjustNodes(r,a);this.setState({nodes:c})}var d=this.props.nodes!==e.nodes||this.props.edges!==e.edges;this.removeOldEdges(t.edges,o),this.removeOldNodes(t.nodes,t.nodesMap,a),this.addNewNodes(this.state.nodes,t.nodesMap,s,t.selectedNodeObj,d),this.addNewEdges(this.state.edges,t.edgesMap,i,t.selectedEdgeObj,d),this.setState({componentUpToDate:!0})}},{key:"getNodeById",value:function(e,t){var n=t||this.state.nodesMap;return n?n["key-".concat(e||"")]:null}},{key:"getEdgeBySourceTarget",value:function(e,t){return this.state.edgesMap?this.state.edgesMap["".concat(e,"_").concat(t)]:null}},{key:"deleteEdgeBySourceTarget",value:function(e,t){this.state.edgesMap&&this.state.edgesMap["".concat(e,"_").concat(t)]&&delete this.state.edgesMap["".concat(e,"_").concat(t)]}},{key:"addNewNodes",value:function(e,t,n,a){var o=this,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this.state.draggingEdge){var s=this.props.nodeKey,i=null,l=null;ve.yieldingLoop(e.length,50,function(c){i=e[c],null!=(l=o.getNodeById(i[s],t))&&(l.node!==i||n.node!==a.node&&(n.node&&i[s]===n.node[s]||a.node&&i[s]===a.node[s]))?o.asyncRenderNode(i):!r&&l||o.asyncRenderNode(i)})}}},{key:"removeOldNodes",value:function(e,t,n){for(var a=this,o=this.props.nodeKey,r=function(r){var s=e[r][o];if(a.getNodeById(s,n))return"continue";var i=a.getNodeById(s,t);i.outgoingEdges.forEach(function(e){a.removeEdgeElement(e.source,e.target)}),i.incomingEdges.forEach(function(e){a.removeEdgeElement(e.source,e.target)}),setTimeout(function(){ve.removeElementFromDom("node-".concat(s,"-container"))})},s=0;s<e.length;s++)r(s)}},{key:"addNewEdges",value:function(e,t,n,a){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this.state.draggingEdge)for(var r=null,s=0;s<e.length;s++)if((r=e[s]).source&&r.target){var i=t["".concat(r.source,"_").concat(r.target)];(o||!i||n!==a&&(n.edge&&r===n.edge||a.edge&&a.edge))&&this.asyncRenderEdge(r)}}},{key:"removeEdgeElement",value:function(e,t){var n="".concat(e,"-").concat(t);ve.removeElementFromDom("edge-".concat(n,"-container"))}},{key:"canSwap",value:function(e,t,n){return t&&e!==t&&(n.source!==e[this.props.nodeKey]||n.target!==t[this.props.nodeKey])}},{key:"deleteNode",value:function(e){var t=this.props.nodeKey,n=this.state.nodes,a=e[t],o=n.filter(function(e){return e[t]!==a});this.setState({componentUpToDate:!1,hoveredNode:!1}),ve.removeElementFromDom("node-".concat(a,"-container")),this.props.onSelectNode(null),this.props.onDeleteNode(e,a,o)}},{key:"deleteEdge",value:function(e){var t=this.state.edges;if(e.source&&e.target){var n=t.filter(function(t){return!(t.source===e.source&&t.target===e.target)});e.source&&e.target&&this.deleteEdgeBySourceTarget(e.source,e.target),this.setState({componentUpToDate:!1,edges:n}),e.source&&e.target&&(ve.removeElementFromDom("edge-".concat(e.source,"-").concat(e.target,"-custom-container")),ve.removeElementFromDom("edge-".concat(e.source,"-").concat(e.target,"-container"))),this.props.onDeleteEdge(e,n)}}},{key:"isPartOfEdge",value:function(e){return!!ve.findParent(e,".edge-container")}},{key:"createNewEdge",value:function(){var e=this,t=this.props,n=t.canCreateEdge,a=t.nodeKey,o=t.onCreateEdge,r=this.state,s=r.edgesMap,i=r.edgeEndNode,l=r.hoveredNodeData;if(l&&(ve.removeElementFromDom("edge-custom-container"),i)){var c="".concat(l[a],"_").concat(i[a]),d="".concat(i[a],"_").concat(l[a]);s&&l!==i&&n&&n(l,i)&&!s[c]&&!s[d]?this.service.areCompatible(l.instance,i.instance).then(function(t){if(!0===Boolean(t.value)){var n={source:l[a],target:i[a]};e.setState({componentUpToDate:!1,draggedEdge:null,draggingEdge:!1}),e.syncRenderEdge(n),e.syncRenderNode(i),o(l,i)}else alert("Cannot connect - types are not compatible: "+l.instance.cellType.transformType+" -> "+i.instance.cellType.transformType)}):this.setState({edgeEndNode:null,draggingEdge:!1})}}},{key:"isArrowClicked",value:function(e){var t=this.props,n=(t.nodeSize,t.edgeArrowSize),a=ee.b.sourceEvent.target,o=n||0;if(!e||"path"!==a.tagName)return!1;var r=ee.d(a);if(!e.target)return!1;this.getNodeById(e.target);var s=r[0],i=r[1],l=be.parsePathToXY(be.getEdgePathElement(e,this.viewWrapper.current));return s<l.target.x+o&&s>l.target.x-o&&i<l.target.y+o&&i>l.target.y-o}},{key:"zoomFilter",value:function(){return!ee.b.button&&!ee.b.ctrlKey}},{key:"containZoom",value:function(){(ee.b.button||ee.b.ctrlKey)&&ee.b.stopImmediatePropagation()}},{key:"getMouseCoordinates",value:function(){var e=[0,0];return this.selectedView&&(e=ee.d(this.selectedView.node())),e}},{key:"dragEdge",value:function(e){var t=this.props,n=t.nodeSize,a=t.nodeKey;if(e=e||this.state.draggedEdge){var o=this.getMouseCoordinates(),r={x:o[0],y:o[1]},s=be.calculateOffset(n,this.getNodeById(e.source).node,r,a);r.x+=s.xOff,r.y+=s.yOff,this.syncRenderEdge({source:e.source,targetPosition:r}),this.setState({draggedEdge:e,draggingEdge:!0})}}},{key:"setZoom",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=ee.g.translate(t,n).scale(e);ee.e(this.viewWrapper.current).select("svg").transition().duration(a).call(this.zoom.transform,o)}},{key:"renderView",value:function(){this.selectedView.attr("transform",this.state.viewTransform),clearTimeout(this.renderNodesTimeout),this.renderNodesTimeout=setTimeout(this.renderNodes)}},{key:"renderNode",value:function(e,t){if(!this.entities)return null;var n="".concat(e,"-container"),a=document.getElementById(n);a||((a=document.createElementNS("http://www.w3.org/2000/svg","g")).id=n,this.entities.appendChild(a));var o=t;s.a.render(o,a)}},{key:"renderConnectedEdgesFromNode",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.state.draggingEdge||(e.incomingEdges.forEach(function(e){t.asyncRenderEdge(e,n)}),e.outgoingEdges.forEach(function(e){t.asyncRenderEdge(e,n)}))}},{key:"asyncRenderNode",value:function(e){var t=this,n=this.props.nodeKey,a="nodes-".concat(e[n]);cancelAnimationFrame(this.nodeTimeouts[a]),this.nodeTimeouts[a]=requestAnimationFrame(function(){t.syncRenderNode(e)})}},{key:"syncRenderNode",value:function(e){var t=this.props.nodeKey,n="node-".concat(e[t]),a=this.getNodeComponent(n,e),o=this.getNodeById(e[t]);this.renderNode(n,a),o&&this.renderConnectedEdgesFromNode(o)}},{key:"syncRenderEdge",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.source){var n=e.target?"".concat(e.source,"-").concat(e.target):"custom",a="edge-".concat(n),o=this.getEdgeComponent(e);this.renderEdge(a,o,e,t)}}},{key:"renderGraphControls",value:function(){if(this.props.showGraphControls&&this.viewWrapper){var e=this.viewWrapper.current.querySelector(".graph-controls-wrapper");e&&s.a.render(a.createElement(Se,{ref:this.graphControls,minZoom:this.props.minZoom,maxZoom:this.props.maxZoom,zoomLevel:this.state.viewTransform?this.state.viewTransform.k:1,zoomToFit:this.handleZoomToFit,modifyZoom:this.modifyZoom}),e)}}},{key:"render",value:function(){var e=this,t=this.props,n=t.edgeArrowSize,o=t.gridSpacing,r=t.gridDotSize,s=t.nodeTypes,i=t.nodeSubtypes,l=t.edgeTypes,c=t.renderDefs;return a.createElement("div",{className:"view-wrapper",ref:this.viewWrapper},a.createElement("svg",{className:"graph",ref:this.graphSvg},a.createElement(pe,{edgeArrowSize:n,gridSpacing:o,gridDotSize:r,nodeTypes:s,nodeSubtypes:i,edgeTypes:l,renderDefs:c}),a.createElement("g",{className:"view",ref:function(t){return e.view=t}},this.renderBackground(),a.createElement("g",{className:"entities",ref:function(t){return e.entities=t}}))),a.createElement("div",{className:"graph-controls-wrapper"}))}}]),t}(a.Component);xe.defaultProps={canCreateEdge:function(e,t){return!0},canDeleteEdge:function(){return!0},canDeleteNode:function(){return!0},edgeArrowSize:8,gridSpacing:36,layoutEngineType:"None",maxTitleChars:9,maxZoom:1.5,minZoom:.15,nodeSize:154,readOnly:!1,showGraphControls:!0,zoomDelay:1e3,zoomDur:750};var je=xe,De=n(770),Me=n(771),Ie=n(772),Re=n(773),Ae=n(774),Be=n(775),ze=n(776),Fe=n(777),Pe=n(778),Ue=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).state={dropdownOpen:!1,selected:void 0,delay:0},n.toggle=e.toggle,n.dropToggle=n.dropToggle.bind(Object(E.a)(Object(E.a)(n))),n.srcCell=e.sourceCell,n.destCell=e.destCell,n.service=new Te,n.onConnectCells=e.onConnectCells,n}return Object(u.a)(t,e),Object(l.a)(t,[{key:"dropToggle",value:function(){this.setState(function(e){return{dropdownOpen:!e.dropdownOpen}})}},{key:"submit",value:function(){this.service.connectCells(this.srcCell.instance,this.destCell.instance,this.state.delay,this.state.selected),this.onConnectCells(this.srcCell,this.destCell,this.state.selected,this.state.delay),this.toggle()}},{key:"render",value:function(){var e=this,t=this.destCell.instance.cellType.function.variables.map(function(e){return e.variableName});return o.a.createElement("div",null,o.a.createElement(De.a,{toggle:this.toggle},"Connect Cells"),o.a.createElement(Me.a,null,o.a.createElement(Ie.a,null,o.a.createElement(C.a,{row:!0},o.a.createElement(T.a,{for:"delay",sm:2},"Delay:"),o.a.createElement(Re.a,{sm:10},o.a.createElement(x.a,{type:"number",pattern:"[0-9]*",min:"0",name:"delay",id:"delay",placeholder:"0, 1, 2, 3...",value:this.state.delay,onChange:function(t){return e.setState({delay:t.target.value})}}))),o.a.createElement(C.a,{row:!0},o.a.createElement(T.a,{for:"variable",sm:6},"Destination Variable:"),o.a.createElement(Re.a,{sm:6},o.a.createElement(Ae.a,{isOpen:this.state.dropdownOpen,toggle:this.dropToggle},o.a.createElement(Be.a,{caret:!0},this.state.selected?this.state.selected:"Select Variable"),o.a.createElement(ze.a,{className:"variablePicker"},o.a.createElement(Fe.a,{header:!0},"Choose one:"),t.map(function(t,n){return o.a.createElement(Fe.a,{key:n,onClick:function(){return e.setState({selected:t})}},t," ")}))))))),o.a.createElement(Pe.a,null,o.a.createElement(f.a,{color:"primary",onClick:this.submit.bind(this),disabled:!this.state.selected||!this.state.delay},"Connect")," ",o.a.createElement(f.a,{color:"secondary",onClick:this.toggle},"Cancel")))}}]),t}(o.a.Component),Ze={edges:[],nodes:[]};var Le=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).makeItLarge=function(){var e=n.state.graph,t=function(e){for(var t={edges:[],nodes:[]},n=0,a=0,o=e||0,r=1;r<=o;r++)r%20===0?(n++,a=0):a++,t.nodes.push({id:"a".concat(r),title:"Node ".concat(r),type:L[Math.floor(L.length*Math.random())],x:0+200*a,y:0+200*n});for(var s=1;s<o;s++)t.edges.push({source:"a".concat(s),target:"a".concat(s+1),type:V[Math.floor(V.length*Math.random())]});return t}(n.state.totalNodes);e.nodes=t.nodes,e.edges=t.edges,n.setState(n.state)},n.addStartNode=function(){var e=n.state.graph;e.nodes=[{id:Date.now(),title:"Node A",type:P,x:0,y:0}].concat(Object(Q.a)(n.state.graph.nodes)),n.setState({graph:e})},n.deleteStartNode=function(){var e=n.state.graph;e.nodes.splice(0,1),e.nodes=Object(Q.a)(n.state.graph.nodes),n.setState({graph:e})},n.handleChange=function(e){n.setState({totalNodes:parseInt(e.target.value||"0",10)},n.makeItLarge)},n.onUpdateNode=function(e){var t=n.state.graph,a=n.getNodeIndex(e);t.nodes[a]=e,n.setState({graph:t})},n.onSelectNode=function(e){n.state.simulationMode?n.state.simulationStep===ft&&null!==e&&n.onOutputCellSelected(e):n.setState({selected:e})},n.onSelectEdge=function(e){n.setState({selected:e})},n.onCreateNode=function(e,t){var a=n.state.graph;if(null!=n.state.selectedType){var o=n.state.selectedType.view,r={id:new Date,title:n.state.selectedType.function.expression,type:o,x:e,y:t};a.nodes=[].concat(Object(Q.a)(a.nodes),[r]),n.setState({graph:a}),n.service.addCellInstance(n.state.selectedType,e,t).then(function(e){r.instance=e,console.log(n.state.graph)}),n.onAddCellOrConnectCells()}},n.onDeleteNode=function(e,t,a){var o=n.state.graph,r=o.edges.filter(function(t,n){return t.source!==e[F]&&t.target!==e[F]});o.nodes=a,o.edges=r,n.service.deleteCellInstance(e.instance.id),n.setState({graph:o,selected:null}),n.onAddCellOrConnectCells()},n.onCreateEdge=function(e,t){var a=n.state.graph,o=e.type===P?Z:U,r={source:e[F],target:t[F],type:o};console.log(JSON.stringify(r)),n.srcCell=e,n.destCell=t,n.toggle(),n.onAddCellOrConnectCells(),r.source!==r.target&&(a.edges=[].concat(Object(Q.a)(a.edges),[r]),n.setState({graph:a,selected:r}))},n.onSwapEdge=function(e,t,a){var o=n.state.graph,r=n.getEdgeIndex(a),s=JSON.parse(JSON.stringify(o.edges[r]));s.source=e[F],s.target=t[F],o.edges[r]=s,o.edges=Object(Q.a)(o.edges),n.setState({graph:o,selected:s}),n.onAddCellOrConnectCells()},n.onDeleteEdge=function(e,t){var a=n.state.graph;a.edges=t,n.service.deleteConnection(e.id),n.setState({graph:a,selected:null}),n.onAddCellOrConnectCells()},n.onUndo=function(){console.warn("Undo is not currently implemented in the example.")},n.onCopySelected=function(){if(n.state.selected.source)console.warn("Cannot copy selected edges, try selecting a node instead.");else{var e=n.state.selected.x+10,t=n.state.selected.y+10;n.setState({copiedNode:Object(Y.a)({},n.state.selected,{x:e,y:t})})}},n.onPasteSelected=function(){n.state.copiedNode||console.warn("No node is currently in the copy queue. Try selecting a node and copying it with Ctrl/Command-C");var e=n.state.graph,t=Object(Y.a)({},n.state.copiedNode,{id:Date.now()});e.nodes=[].concat(Object(Q.a)(e.nodes),[t]),n.forceUpdate()},n.handleChangeLayoutEngineType=function(e){n.setState({layoutEngineType:e.target.value})},n.state={copiedNode:null,graph:Ze,layoutEngineType:void 0,selected:null,totalNodes:Ze.nodes.length,selectedType:e.selectedType,connectModal:!1,simulationMode:e.simulationMode,simulationStep:e.simulationStep,simulationOutputCells:[],updatedInputCells:!1},n.GraphView=a.createRef(),n.service=new Te,n.toggle=n.toggle.bind(Object(E.a)(Object(E.a)(n))),n.onOutputCellSelected=e.onOutputCellSelected,n.onAddCellOrConnectCells=n.props.onAddCellOrConnectCells,n.refresh(),n}return Object(u.a)(t,e),Object(l.a)(t,[{key:"componentWillReceiveProps",value:function(e){e.simulationStep!==yt||this.state.updatedInputCells||this.setState({updatedInputCells:!0}),this.setState({selectedType:e.selectedType,simulationMode:e.simulationMode,simulationStep:e.simulationStep})}},{key:"refresh",value:function(){var e=this,t=this.state.graph;t.nodes=[],this.service.getCellInstances().then(function(n){n.forEach(function(e,n){console.log("#"+n+") "+JSON.stringify(e));var a=e.id,o=e.xCoordinate,r=e.yCoordinate,s={id:a,title:e.cellType.function.expression,type:"INPUT_TO_ANALOG"!==e.cellType.transformType?"customEmpty":P,x:o,y:r};s.instance=e,t.nodes.push(s)}),e.service.getConnections().then(function(n){t.edges=n.filter(function(e){return null!==e.fromCell&&null!==e.toCell}).map(function(e){var t="Input"===e.fromCell.cellType.name?Z:U;return{source:e.fromCell.id,target:e.toCell.id,type:t,handleText:e.variable.variableName,id:e.id}}),e.setState({graph:t})})}),this.onAddCellOrConnectCells()}},{key:"componentDidMount",value:function(){this.refresh()}},{key:"getNodeIndex",value:function(e){return this.state.graph.nodes.findIndex(function(t){return t[F]===e[F]})}},{key:"getEdgeIndex",value:function(e){return this.state.graph.edges.findIndex(function(t){return t.source===e.source&&t.target===e.target})}},{key:"getViewNode",value:function(e){var t={};t[F]=e;var n=this.getNodeIndex(t);return this.state.graph.nodes[n]}},{key:"toggle",value:function(){this.setState(function(e){return{connectModal:!e.connectModal}})}},{key:"onConnectCells",value:function(e,t,n,a){var o=this.state.graph;o.edges=o.edges.filter(function(e){return e.handleText&&(e.target!==t.id||e.handleText!==n)||!e.handleText});var r=o.edges.findIndex(function(n){return n.source===e.id&&n.target===t.id});console.log("Current edges:\n"+JSON.stringify(o.edges)),console.log("source:"+JSON.stringify(e)),console.log("target:"+JSON.stringify(t)),console.log("index: "+r),console.log("connection variable: "+n),r>=0&&(console.log(JSON.stringify(o.edges)),o.edges[r].handleText=n,this.setState({graph:o})),this.onAddCellOrConnectCells()}},{key:"render",value:function(){var e=this,t=this.state.graph,n=t.nodes,o=t.edges,r=this.state.selected,s=X.NodeTypes,i=X.NodeSubtypes,l=X.EdgeTypes;return a.createElement("div",{id:"graph"},a.createElement(je,{className:"graphView",ref:function(t){return e.GraphView=t},nodeKey:F,nodes:n,edges:o,selected:r,nodeTypes:s,nodeSubtypes:i,edgeTypes:l,onSelectNode:this.onSelectNode,onCreateNode:this.onCreateNode,onUpdateNode:this.onUpdateNode,onDeleteNode:this.onDeleteNode,onSelectEdge:this.onSelectEdge,onCreateEdge:this.onCreateEdge,onSwapEdge:this.onSwapEdge,onDeleteEdge:this.onDeleteEdge,onUndo:this.onUndo,onCopySelected:this.onCopySelected.bind(this),onPasteSelected:this.onPasteSelected.bind(this),layoutEngineType:this.state.layoutEngineType,service:this.service}),a.createElement(O.a,{isOpen:this.state.connectModal,toggle:this.toggle},a.createElement(Ue,{toggle:this.toggle,sourceCell:this.srcCell,destCell:this.destCell,onConnectCells:this.onConnectCells.bind(this)})))}}]),t}(a.Component),Ve=n(324),He=n(320),Ke=n.n(He),Ge=n(321),_e=n.n(Ge),We=n(322),Je=n.n(We),Xe=n(323),qe=n.n(Xe),$e=n(149),Ye=n.n($e),Qe=n(199),et=n.n(Qe),tt=n(97),nt=n.n(tt),at=n(316),ot=n.n(at),rt=(n(574),n(576),n(785)),st=n(779),it=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.outputCells;return o.a.createElement(b.a,{className:"listGroup",flush:!0},e.map(function(e){return o.a.createElement(N.a,{key:e.instance.id,className:"outputCell"},o.a.createElement("div",{className:"removeButton"},o.a.createElement(rt.a,null)),o.a.createElement(st.a,{className:"outputCellHeader"},e.instance.cellType.name),o.a.createElement("small",null,e.instance.id))}))}}]),t}(o.a.Component),lt=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(l.a)(t,[{key:"isNetworkStructureValid",value:function(){var e=this.baseUrl+"/simulate/isNetworkValid/";return D()(e,{method:"GET",headers:this.headers}).then(function(e){return console.log(e),e.json()}).then(function(e){return console.log(e),e}).catch(function(e){return alert(e)})}},{key:"simulateNetwork",value:function(e,t,n){var a=this.baseUrl+"/simulate",o=this.headers;return console.log(a),D()(a,{method:"POST",body:JSON.stringify({outputCells:e,userInput:t,maxTime:n}),headers:o}).then(function(e){return console.log(e),e.json()}).then(function(e){return console.log(e),e}).catch(function(e){return alert(e)})}}]),t}(M);var ct=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).state={csvHeaders:null},n}return Object(u.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;(new Te).getInputCells().then(function(t){var n=t.map(function(e){return""+e.id});e.setState({csvHeaders:n})})}},{key:"transpose",value:function(e){return e[0].map(function(t,n){return e.map(function(e){return e[n]})})}},{key:"handleFileUpload",value:function(e){var t=this,n=new FileReader;n.onloadend=function(){var e=n.result,a=ot.a.parse(e);0!==a.errors.length?alert(a.errors.map(function(e){return"Message:  "+e.message+"\nRow:  "+e.row})):t.inputData=t.transpose(a.data)},n.readAsText(e)}},{key:"getSelectingOutputCellsView",value:function(){var e=this.props.outputCells;return o.a.createElement("div",null,o.a.createElement(nt.a,null,"Click on the cells that you want to see their calculations output over time."),o.a.createElement(it,{outputCells:e}))}},{key:"getUploadingInputFileView",value:function(){return o.a.createElement("div",null,o.a.createElement(nt.a,null,"Download the following file and fill it with your data:"),o.a.createElement(q.CSVLink,{filename:"RetinaX_Input_File.csv",data:[this.state.csvHeaders]},"Click Here"))}},{key:"getShowingResultsView",value:function(){var e=this;return o.a.createElement("div",null,o.a.createElement(nt.a,null,"Upload your input data file here:"),o.a.createElement("input",{type:"file",accept:".csv",style:{fontSize:"15px"},onChange:function(t){return e.handleFileUpload(t.target.files[0])}}))}},{key:"getStepContent",value:function(e){switch(e){case ft:return this.getSelectingOutputCellsView();case yt:return this.getUploadingInputFileView();case vt:return this.getShowingResultsView();default:return"Unknown step"}}},{key:"simulateNetwork",value:function(){var e=this,t=new lt,n=this.props.outputCells.map(function(e){return e.instance}),a={};this.inputData.forEach(function(e){a[e[0]]=e.slice(1,e.length)});var o=this.inputData[0].length-1;t.simulateNetwork(n,a,o).then(function(t){e.props.onResultsArrived(t,o)})}},{key:"render",value:function(){var e=this,t=this.props,n=t.classes,a=t.activeStep,r=t.handleBack,s=t.handleNext,i=t.handleReset,l=["Select Output Cells","Download Input Data File Format","Upload Filled Input File"];return o.a.createElement("div",{className:n.root+" stepper-container"},o.a.createElement("h2",{className:"pickerTitle"},"Simulation"),o.a.createElement(Ke.a,{className:"stepper",activeStep:a,orientation:"vertical"},l.map(function(t,i){return o.a.createElement(_e.a,{key:t},o.a.createElement(Je.a,null,t),o.a.createElement(qe.a,null,e.getStepContent(i),o.a.createElement("div",{className:n.actionsContainer},o.a.createElement("div",null,o.a.createElement(Ye.a,{disabled:0===a,onClick:r,className:n.button},"Back"),o.a.createElement(Ye.a,{variant:"contained",onClick:function(){a===vt&&(console.log("simulateNetwork()"),e.simulateNetwork()),console.log("next()"),s()},color:"primary",className:"stepperButton",disabled:0===e.props.outputCells.length},a===l.length-1?"Simulate":"Next")))))})),a===l.length&&o.a.createElement(et.a,{square:!0,elevation:0,className:n.resetContainer},o.a.createElement(nt.a,null,"All steps completed - you're finished"),o.a.createElement(Ye.a,{onClick:i,className:n.button},"Reset")))}}]),t}(o.a.Component),dt=Object(Ve.withStyles)(function(e){return{root:{width:"90%"},button:{marginTop:e.spacing.unit,marginRight:e.spacing.unit},actionsContainer:{marginBottom:2*e.spacing.unit},resetContainer:{padding:3*e.spacing.unit}}})(ct),ut=n(784),ht=(n(676),function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.outputCells,n=e.outputResults,a=e.maxTime,r=[{title:"t",dataIndex:"t",fixed:"left",width:60}];t.forEach(function(e){return r.push({title:e.id+" ("+e.instance.cellType.name+")",dataIndex:e.id.toString(),width:200,key:e.id})});for(var s=[],i=function(e){var t={};r.forEach(function(a){"t"==a.dataIndex?t[a.dataIndex]=e:t[a.dataIndex]=n[a.dataIndex][e].value,t.key=e}),s.push(t)},l=0;l<a;l++)i(l);return o.a.createElement("div",null,o.a.createElement(ut.a,{columns:r,dataSource:s,bordered:!0,size:"middle",useFixedHeader:!0,pagination:{pageSize:10},scroll:{y:240,x:500}}))}}]),t}(o.a.Component)),pt=(n(747),function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){for(var e=this.props,t=e.isOpen,n=e.toggle,a=e.outputCells,r=e.outputResults,s=e.maxTime,i=a.map(function(e){return e.id}),l=[],c=function(e){var t=[];i.forEach(function(n){console.log("outputResults: "+JSON.stringify(r)),t.push(r[n.toString()][e].value)}),l.push(t)},d=0;d<s;d++)c(d);return o.a.createElement(O.a,{className:"resultsModal",isOpen:t,toggle:n},o.a.createElement(De.a,{className:"resultsModal"},"Results:"),o.a.createElement(Me.a,{className:"resultsModal"},o.a.createElement(ht,{outputCells:a,outputResults:r,maxTime:s})),o.a.createElement(Pe.a,{className:"resultsModal"},o.a.createElement(q.CSVLink,{className:"btn btn-success",filename:"RetinaX_Results_File.csv",headers:i,data:l},o.a.createElement("img",{src:"/images/csv.svg"}),"\xa0 Download as CSV")))}}]),t}(o.a.Component)),gt=n(780),mt=-1,ft=0,yt=1,vt=2,Et=function(e){function t(){var e;return Object(i.a)(this,t),(e=Object(c.a)(this,Object(d.a)(t).call(this))).handleNext=function(){e.setState(function(e){return{activeStep:e.activeStep+1}})},e.handleBack=function(){e.setState(function(e){return{activeStep:e.activeStep-1}})},e.handleReset=function(){e.setState({activeStep:0})},e.state={selectedType:null,simulationMode:!1,selectedOutputCells:[],activeStep:mt,showResults:!1,outputResults:null,maxTime:null,networkIsValid:!1},e.simulateService=new lt,e}return Object(u.a)(t,e),Object(l.a)(t,[{key:"setSelectedCellType",value:function(e){var t=e;"INPUT_TO_ANALOG"!==e.transformType?t.view="customEmpty":t.view=P,this.setState({selectedType:t})}},{key:"onSimulateNetworkClicked",value:function(){this.setState({simulationMode:!this.state.simulationMode,activeStep:ft})}},{key:"onOutputCellSelected",value:function(e){var t=this.state.selectedOutputCells;0===t.filter(function(t){return t.instance.id===e.instance.id}).length&&(t.push(e),this.setState({selectedOutputCells:t}))}},{key:"toggleShowResults",value:function(){this.setState({showResults:!this.state.showResults})}},{key:"onResultsArrived",value:function(e,t){this.setState({outputResults:e.cellsResults,maxTime:t,showResults:!0})}},{key:"componentDidMount",value:function(){this.refreshNetworkValidation()}},{key:"refreshNetworkValidation",value:function(){var e=this;this.simulateService.isNetworkStructureValid().then(function(t){e.setState({networkIsValid:Boolean(t.value)})})}},{key:"render",value:function(){var e,t=this,n=this.state.simulationMode?"":"Simulate Network",a=this.state.simulationMode?o.a.createElement(dt,{className:"picker",activeStep:this.state.activeStep,handleNext:this.handleNext.bind(this),handleBack:this.handleBack.bind(this),handleReset:this.handleReset.bind(this),outputCells:this.state.selectedOutputCells,onResultsArrived:this.onResultsArrived.bind(this)}):o.a.createElement($,{className:"picker",setSelectedType:this.setSelectedCellType.bind(this)});return e=this.state.networkIsValid?o.a.createElement("span",null,o.a.createElement("button",{className:"simulateNetworkButton btn btn-secondary",hidden:this.state.simulationMode,onClick:this.onSimulateNetworkClicked.bind(this)},o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"7",height:"8",viewBox:"0 0 7 8",className:"primary"},o.a.createElement("polygon",{fill:"#FFFFFF",fillRule:"evenodd",points:"13 10 13 18 20 14",transform:"translate(-13 -10)"}))," \xa0",n,"\xa0"),this.state.simulationMode&&o.a.createElement("button",{className:"simulateNetworkButton btn btn-secondary",onClick:function(){return t.setState({simulationMode:!1})}}," Cancel ")):o.a.createElement(gt.a,{color:"warning"},"The current network structure is not yet valid for simulation"),o.a.createElement("div",{className:"networkBuilder"},e,o.a.createElement("div",{className:"networkBuilderBody"},a,o.a.createElement(Le,{className:"graphView",selectedType:this.state.selectedType,simulationMode:this.state.simulationMode,simulationStep:this.state.activeStep,onOutputCellSelected:this.onOutputCellSelected.bind(this),onAddCellOrConnectCells:this.refreshNetworkValidation.bind(this)})),o.a.createElement(pt,{toggle:this.toggleShowResults.bind(this),isOpen:this.state.showResults,outputCells:this.state.selectedOutputCells,outputResults:this.state.outputResults,maxTime:this.state.maxTime}))}}]),t}(a.Component),bt=function(){return o.a.createElement(p.a,null,o.a.createElement(g.a,{exact:!0,path:"/",component:v}),o.a.createElement(g.a,{exact:!0,path:"/networkBuilder",component:Et}),o.a.createElement(g.a,{exact:!0,path:"/createCellType",component:R}))},Nt=n(781),Ot=n(782),St=n(783),kt=(n(750),function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return o.a.createElement(h.a,{basename:"RetinaX"},o.a.createElement("div",{className:"App"},o.a.createElement("div",null,o.a.createElement(Nt.a,{className:"Nav",expand:"md"},o.a.createElement(Ot.a,{href:"/",className:"homeButton"},o.a.createElement("h1",{className:"homeButton"},o.a.createElement("span",{className:"retina"},"Retina"),o.a.createElement("span",{className:"x"},"X"))),o.a.createElement(St.a,{className:"ml-auto",navbar:!0})),o.a.createElement(bt,null))))}}]),t}(a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(752);s.a.render(o.a.createElement(kt,null),document.getElementById("root"))}},[[326,2,1]]]);
//# sourceMappingURL=main.50942112.chunk.js.map